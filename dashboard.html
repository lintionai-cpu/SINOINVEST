<!DOCTYPE html>
<html lang="en" class="h-full">

  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SinoInvest — Client Dashboard</title>

    <link rel="icon" type="img/png" sizes="32x32" href="../img/favicon-32x32.png">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            boxShadow: {
              soft: '0 10px 30px rgba(0,0,0,0.06)'
            }
          }
        }
      }
    </script>
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Chart.js (for Pie/Bar/Line) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Firebase v10 SDKs -->
    <script type="module" crossorigin src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js"></script>
    <script type="module" crossorigin src="https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js"></script>
    <script type="module" crossorigin src="https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js"></script>
    <script type="module" crossorigin src="https://www.gstatic.com/firebasejs/10.13.0/firebase-storage.js"></script>
    <style>
      /* Smooth section transitions */
      .page {
        display: none;
      }

      .page.active {
        display: block;
      }

    </style>
  </head>

  <body class="h-full bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100">
    <!-- Toast -->
    <div id="toast" class="fixed top-5 right-5 z-50 hidden"></div>

    <!-- App Shell -->
    <div class="min-h-screen grid grid-cols-1 lg:grid-cols-[260px,1fr]">
      <!-- Sidebar -->
      <aside
        class="bg-white dark:bg-gray-800 border-r border-gray-100 dark:border-gray-700 p-4 lg:sticky lg:top-0 lg:h-screen shadow-soft">
        <div class="flex items-center gap-3 mb-8">
          <div class="h-10 w-10 rounded-2xl grid place-items-center text-white font-bold">
            <img src="favicon.ico" alt="">
          </div>
          <div>
            <h1 class="text-lg font-semibold"><b>SINOinvest</b></h1>                      
            <p class="text-xs text-gray-500 dark:text-gray-400">Client Dashboard</p>
          </div>
        </div>

        <nav class="space-y-1" id="sideNav">
          <a data-route="#/dashboard"
            class="nav-link flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-700 font-medium">
            <i data-lucide="layout-dashboard" class="w-4 h-4"></i><span>Dashboard</span>
          </a>
          <a data-route="#/portfolio"
            class="nav-link flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-700 font-medium">
            <i data-lucide="pie-chart" class="w-4 h-4"></i><span>Portfolio</span>
          </a>
          <a data-route="#/transactions"
            class="nav-link flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-700 font-medium">
            <i data-lucide="rows" class="w-4 h-4"></i><span>Transactions</span>
          </a>
          <a data-route="#/funds"
            class="nav-link flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-700 font-medium">
            <i data-lucide="wallet" class="w-4 h-4"></i><span>Withdraw / Deposit</span>
          </a>
          <a data-route="#/messages"
            class="nav-link flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-700 font-medium">
            <i data-lucide="message-square" class="w-4 h-4"></i><span>Messages</span>
          </a>
          <a data-route="#/settings"
            class="nav-link flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-700 font-medium">
            <i data-lucide="settings" class="w-4 h-4"></i><span>Settings</span>
          </a>
          <a data-route="#/support"
            class="nav-link flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-700 font-medium">
            <i data-lucide="life-buoy" class="w-4 h-4"></i><span>Support</span>
          </a>
        </nav>

        <div class="mt-8 space-y-2">
          <button id="btn-dark"
            class="w-full flex items-center justify-between px-3 py-2 rounded-xl bg-gray-100 dark:bg-gray-700">
            <span class="flex items-center gap-2"><i data-lucide="moon" class="w-4 h-4"></i> Dark Mode</span>
            <span id="darkState" class="text-xs px-2 py-0.5 rounded bg-gray-200 dark:bg-gray-600">Auto</span>
          </button>
          <button id="btn-signout"
            class="w-full flex items-center gap-2 px-3 py-2 rounded-xl border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700">
            <i data-lucide="log-out" class="w-4 h-4"></i> Sign out
          </button>
        </div>
      </aside>

      <!-- Main -->
      <main class="p-4 sm:p-6 lg:p-8 space-y-6">
        <!-- Topbar -->
        <header class="flex items-center justify-between">
          <div>
            <h2 id="pageTitle" class="text-xl sm:text-2xl font-bold">Dashboard</h2>
            <p class="text-xs text-gray-500 dark:text-gray-400" id="userEmail">—</p>
          </div>
          <div class="flex items-center gap-2">
            <div class="relative">
              <button id="btn-notify"
                class="p-2 rounded-xl border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800">
                <i data-lucide="bell" class="w-5 h-5"></i>
              </button>
              <span id="badge"
                class="absolute -top-1 -right-1 text-[10px] bg-rose-500 text-white rounded-full px-1.5 py-0.5 hidden">0</span>
            </div>
            <img id="avatar" class="h-9 w-9 rounded-xl object-cover border border-gray-200 dark:border-gray-700"
              src="https://api.dicebear.com/7.x/initials/svg?seed=SI" alt="avatar" />
          </div>
        </header>

        <!-- PAGES -->
        <!-- 1. Dashboard -->
        <section id="page-dashboard" class="page active space-y-6">
          <!-- KPI Cards -->
          <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4">
            <div
              class="p-4 rounded-2xl bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 shadow-soft">
              <p class="text-sm text-gray-500 mb-1">Total Invested</p>
              <h3 id="kpi-invested" class="text-2xl font-bold">$0.00</h3>
            </div>
            <div class="p-4 rounded-2xl bg-white dark:bg-gray-800 border shadow-soft">
              <p class="text-sm text-gray-500 mb-1">Total Returns</p>
              <h3 id="kpi-returns" class="text-2xl font-bold text-yellow-600">$0.00</h3>
            </div>
            <div class="p-4 rounded-2xl bg-white dark:bg-gray-800 border shadow-soft">
              <p class="text-sm text-gray-500 mb-1">Available Balance</p>
              <h3 id="kpi-balance" class="text-2xl font-bold">$0.00</h3>
            </div>
            <div class="p-4 rounded-2xl bg-white dark:bg-gray-800 border shadow-soft">
              <p class="text-sm text-gray-500 mb-1"> ROI</p>
              <h3 id="kpi-roi7d" class="text-2xl font-bold">0.00%</h3>
            </div>
          </div>

          <!-- Charts Row -->
          <div class="grid grid-cols-1 xl:grid-cols-3 gap-4">
            <div class="xl:col-span-1 p-4 rounded-2xl bg-white dark:bg-gray-800 border shadow-soft">
              <div class="flex items-center justify-between mb-2">
                <h4 class="font-semibold">Asset Allocation</h4>
                <span class="text-xs text-gray-500">Pie</span>
              </div>
              <canvas id="chartAllocation" height="220"></canvas>
            </div>
            <div class="xl:col-span-2 p-4 rounded-2xl bg-white dark:bg-gray-800 border shadow-soft">
              <div class="flex items-center justify-between mb-2">
                <h4 class="font-semibold">ROI by Asset Class</h4>
                <span class="text-xs text-gray-500">Bar</span>
              </div>
              <canvas id="chartROI" height="220"></canvas>
            </div>
          </div>

          <!-- Recent Transactions -->
          <div class="p-4 rounded-2xl bg-white dark:bg-gray-800 border shadow-soft">
            <div class="flex items-center justify-between mb-3">
              <h4 class="font-semibold">Recent Transactions</h4>
              <a href="#/transactions" class="text-sm text-yellow-600 hover:underline">View all</a>
            </div>
            <div class="overflow-x-auto">
              <table class="min-w-full text-sm">
                <thead class="text-left text-gray-500">
                  <tr>
                    <th class="py-2">Date</th>
                    <th class="py-2">Type</th>
                    <th class="py-2">Asset</th>
                    <th class="py-2">Amount</th>
                    <th class="py-2">Status</th>
                  </tr>
                </thead>
                <tbody id="recentTxBody" class="divide-y divide-gray-100 dark:divide-gray-700"></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- 2. Portfolio -->
        <section id="page-portfolio" class="page space-y-6">
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
            <div class="p-4 rounded-2xl bg-white dark:bg-gray-800 border shadow-soft lg:col-span-1">
              <h4 class="font-semibold mb-2">By Asset Class</h4>
              <div class="space-y-3" id="classBreakdown"></div>
            </div>
            <div class="p-4 rounded-2xl bg-white dark:bg-gray-800 border shadow-soft lg:col-span-2">
              <div class="flex items-center justify-between mb-2">
                <h4 class="font-semibold">Portfolio Performance</h4>
                <select id="perfRange"
                  class="text-sm bg-transparent border border-gray-200 dark:border-gray-700 rounded-lg px-2 py-1">
                  <option value="7">7D</option>
                  <option value="30">30D</option>
                  <option value="90">90D</option>
                  <option value="365">1Y</option>
                </select>
              </div>
              <canvas id="chartPerf" height="240"></canvas>
            </div>
          </div>

          <!-- Individual Assets -->
          <div class="p-4 rounded-2xl bg-white dark:bg-gray-800 border shadow-soft">
            <div class="flex items-center justify-between mb-3">
              <h4 class="font-semibold">Holdings</h4>
              <div class="flex gap-2">
                <input id="assetSearch" placeholder="Search asset..."
                  class="text-sm rounded-lg border border-gray-200 dark:border-gray-700 bg-transparent px-3 py-1.5" />
                <select id="assetFilter"
                  class="text-sm rounded-lg border border-gray-200 dark:border-gray-700 bg-transparent px-2 py-1.5">
                  <option value="all">All</option>
                  <option value="stocks">Stocks</option>
                  <option value="crypto">Crypto</option>
                  <option value="real_estate">Real Estate</option>
                </select>
              </div>
            </div>
            <div class="overflow-x-auto">
              <table class="min-w-full text-sm">
                <thead class="text-left text-gray-500">
                  <tr>
                    <th class="py-2">Asset</th>
                    <th class="py-2">Class</th>
                    <th class="py-2">Units</th>
                    <th class="py-2">Avg. Cost</th>
                    <th class="py-2">Market Value</th>
                    <th class="py-2">P/L</th>
                  </tr>
                </thead>
                <tbody id="assetsBody" class="divide-y divide-gray-100 dark:divide-gray-700"></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- 3. Transactions -->
        <section id="page-transactions" class="page space-y-6">
          <div class="p-4 rounded-2xl bg-white dark:bg-gray-800 border shadow-soft">
            <div class="flex flex-wrap items-center gap-2 justify-between mb-3">
              <h4 class="font-semibold">Transaction History</h4>
              <div class="flex gap-2">
                <select id="txTypeFilter"
                  class="text-sm rounded-lg border border-gray-200 dark:border-gray-700 bg-transparent px-2 py-1.5">
                  <option value="all">All types</option>
                  <option value="deposit">Deposit</option>
                  <option value="withdrawal">Withdrawal</option>
                  <option value="transfer">Transfer</option>
                  <option value="dividend">Dividend</option>
                  <option value="trade">Trade</option>
                </select>
                <input type="date" id="txFrom"
                  class="text-sm rounded-lg border border-gray-200 dark:border-gray-700 bg-transparent px-2 py-1.5" />
                <input type="date" id="txTo"
                  class="text-sm rounded-lg border border-gray-200 dark:border-gray-700 bg-transparent px-2 py-1.5" />
              </div>
            </div>
            <div class="overflow-x-auto">
              <table class="min-w-full text-sm">
                <thead class="text-left text-gray-500">
                  <tr>
                    <th class="py-2">Date</th>
                    <th class="py-2">Type</th>
                    <th class="py-2">Reference</th>
                    <th class="py-2">Amount</th>
                    <th class="py-2">Method</th>
                    <th class="py-2">Status</th>
                  </tr>
                </thead>
                <tbody id="txBody" class="divide-y divide-gray-100 dark:divide-gray-700"></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- 4. Funds (Withdraw / Deposit) -->
        <section id="page-funds" class="page space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Deposit -->
            <div class="p-4 rounded-2xl bg-white dark:bg-gray-800 border shadow-soft">
              <h4 class="font-semibold mb-3">Deposit Funds</h4>
              <form id="form-deposit" class="space-y-3">
                <input name="amount" type="number" min="10" step="0.01" placeholder="Amount (USD)"
                  class="w-full rounded-xl border border-gray-200 dark:border-gray-700 bg-transparent px-3 py-2"
                  required />
                <select name="method"
                  class="w-full rounded-xl border border-gray-200 dark:border-gray-700 bg-transparent px-3 py-2"
                  required>
                  <option value="bank">Bank Transfer</option>
                  <option value="card">Debit/Credit Card</option>
                  <option value="crypto">Crypto (USDT/TRC20)</option>
                </select>
                <button
                  class="w-full rounded-xl bg-yellow-600 hover:bg-emerald-700 text-white px-4 py-2">Deposit</button>
              </form>
              <div class="mt-3 text-xs text-gray-500">Linked methods:</div>
              <div id="linkedMethods" class="mt-1 text-sm"></div>
              <button id="btn-link" class="mt-3 text-sm text-yellow-600 hover:underline">Link bank / wallet</button>
            </div>

            <!-- Withdraw -->
            <div class="p-4 rounded-2xl bg-white dark:bg-gray-800 border shadow-soft">
              <h4 class="font-semibold mb-3">Withdraw Funds</h4>
              <form id="form-withdraw" class="space-y-3">
                <input name="amount" type="number" min="10" step="0.01" placeholder="Amount (USD)"
                  class="w-full rounded-xl border border-gray-200 dark:border-gray-700 bg-transparent px-3 py-2"
                  required />
                <select name="method"
                  class="w-full rounded-xl border border-gray-200 dark:border-gray-700 bg-transparent px-3 py-2"
                  required>
                  <option value="bank">Bank Transfer</option>
                  <option value="crypto">Crypto (USDT/TRC20)</option>
                </select>
                <button
                  class="w-full rounded-xl bg-gray-900 dark:bg-gray-700 hover:opacity-90 text-white px-4 py-2">Withdraw</button>
              </form>
              <p class="text-xs text-gray-500 mt-2">Withdrawals T+1; compliance checks may apply.</p>
            </div>
          </div>
        </section>

        <!-- 5. Messages / Notifications -->
        <section id="page-messages" class="page space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <!-- Threads -->
            <div class="p-4 rounded-2xl bg-white dark:bg-gray-800 border shadow-soft md:col-span-1">
              <div class="flex items-center justify-between mb-2">
                <h4 class="font-semibold">Conversations</h4>
                <button id="btn-new-thread" class="text-sm text-yellow-600 hover:underline">New</button>
              </div>
              <div id="threads" class="space-y-2 max-h-[420px] overflow-y-auto"></div>
            </div>
            <!-- Chat -->
            <div class="p-4 rounded-2xl bg-white dark:bg-gray-800 border shadow-soft md:col-span-2">
              <div id="chatWindow" class="h-[360px] overflow-y-auto space-y-3 mb-3"></div>
              <form id="form-message" class="flex gap-2">
                <input id="msgText" placeholder="Type a message..."
                  class="flex-1 rounded-xl border border-gray-200 dark:border-gray-700 bg-transparent px-3 py-2" />
                <button class="rounded-xl bg-yellow-600 hover:bg-gray-700 text-white px-4">Send</button>
              </form>
            </div>
          </div>

          <!-- System Alerts -->
          <div class="p-4 rounded-2xl bg-white dark:bg-gray-800 border shadow-soft">
            <div class="flex items-center justify-between mb-3">
              <h4 class="font-semibold">System Alerts</h4>
              <button id="btn-clear-alerts" class="text-sm text-rose-600 hover:underline">Clear all</button>
            </div>
            <div id="alerts" class="space-y-2"></div>
          </div>
        </section>

        <!-- 6. Settings / Profile -->
        <section id="page-settings" class="page space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Profile -->
            <div class="p-4 rounded-2xl bg-white dark:bg-gray-800 border shadow-soft">
              <h4 class="font-semibold mb-3">Profile</h4>
              <form id="form-profile" class="space-y-3">
                <input name="fullName" placeholder="Full name"
                  class="w-full rounded-xl border border-gray-200 dark:border-gray-700 bg-transparent px-3 py-2" />
                <input name="phone" placeholder="Phone"
                  class="w-full rounded-xl border border-gray-200 dark:border-gray-700 bg-transparent px-3 py-2" />
                <input name="country" placeholder="Country"
                  class="w-full rounded-xl border border-gray-200 dark:border-gray-700 bg-transparent px-3 py-2" />
                <button
                  class="rounded-xl bg-gray-900 dark:bg-gray-700 hover:opacity-90 text-white px-4 py-2">Save</button>
              </form>
            </div>
            <!-- Security -->
            <div class="p-4 rounded-2xl bg-white dark:bg-gray-800 border shadow-soft">
              <h4 class="font-semibold mb-3">Security</h4>
              <form id="form-password" class="space-y-3">
                <input name="current" type="password" placeholder="Current password"
                  class="w-full rounded-xl border border-gray-200 dark:border-gray-700 bg-transparent px-3 py-2" />
                <input name="new" type="password" placeholder="New password"
                  class="w-full rounded-xl border border-gray-200 dark:border-gray-700 bg-transparent px-3 py-2" />
                <button class="rounded-xl bg-gray-900 dark:bg-gray-700 hover:opacity-90 text-white px-4 py-2">Update
                  Password</button>
              </form>
              <div class="mt-4">
                <h5 class="font-medium mb-2">Two-Factor Authentication (2FA)</h5>
                <button id="btn-enable-2fa"
                  class="rounded-xl border border-gray-200 dark:border-gray-700 px-3 py-2 hover:bg-gray-50 dark:hover:bg-gray-700 text-sm">Enable
                  SMS 2FA</button>
                <p class="text-xs text-gray-500 mt-2">Uses Firebase Multi-Factor Auth. SMS fees may apply.</p>
              </div>
            </div>
          </div>

          <!-- Preferences -->
          <div class="p-4 rounded-2xl bg-white dark:bg-gray-800 border shadow-soft">
            <h4 class="font-semibold mb-3">Preferences</h4>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div>
                <label class="text-sm">Language</label>
                <select id="pref-language"
                  class="w-full mt-1 rounded-xl border border-gray-200 dark:border-gray-700 bg-transparent px-3 py-2">
                  <option value="en">English</option>
                  <option value="zh">中文</option>
                  <option value="de">Deutsch</option>
                </select>
              </div>
              <div>
                <label class="text-sm">Theme</label>
                <select id="pref-theme"
                  class="w-full mt-1 rounded-xl border border-gray-200 dark:border-gray-700 bg-transparent px-3 py-2">
                  <option value="system">System</option>
                  <option value="light">Light</option>
                  <option value="dark">Dark</option>
                </select>
              </div>
              <div>
                <label class="text-sm">Currency</label>
                <select id="pref-currency"
                  class="w-full mt-1 rounded-xl border border-gray-200 dark:border-gray-700 bg-transparent px-3 py-2">
                  <option value="USD">USD</option>
                  <option value="EUR">EUR</option>
                  <option value="CNY">CNY</option>
                </select>
              </div>
            </div>
          </div>
        </section>

        <!-- 7. Support / Help Center -->
        <section id="page-support" class="page space-y-6">
          <div class="p-4 rounded-2xl bg-white dark:bg-gray-800 border shadow-soft">
            <h4 class="font-semibold mb-3">FAQs</h4>
            <div class="divide-y divide-gray-200 dark:divide-gray-700" id="faqs">
              <!-- FAQ items populated at runtime -->
            </div>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="p-4 rounded-2xl bg-white dark:bg-gray-800 border shadow-soft">
              <h4 class="font-semibold mb-3">Open a Ticket</h4>
              <form id="form-ticket" class="space-y-3">
                <input name="subject" placeholder="Subject"
                  class="w-full rounded-xl border border-gray-200 dark:border-gray-700 bg-transparent px-3 py-2" />
                <textarea name="message" placeholder="Describe your issue"
                  class="w-full rounded-xl border border-gray-200 dark:border-gray-700 bg-transparent px-3 py-2 h-28"></textarea>
                <button class="rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2">Submit</button>
              </form>
            </div>
            <div class="p-4 rounded-2xl bg-white dark:bg-gray-800 border shadow-soft">
              <h4 class="font-semibold mb-3">Contact</h4>
              <div class="space-y-1 text-sm">
                <p>Email: <a class="text-emerald-600"
                    href="mailto:sinovest@gmail.com?subject=Support%20Request">sinovest@gmail.com</a></p>
                <p>WhatsApp: <a class="text-emerald-600" href="https://wa.me/2340000000000" target="_blank">+234 000 000
                    0000</a></p>
                <p>Telegram: <a class="text-emerald-600" href="https://t.me/sinoinvest" target="_blank">@sinoinvest</a>
                </p>
              </div>
            </div>
          </div>
        </section>

      </main>
    </div>

    <!-- Link Method Modal -->
    <div id="modal" class="fixed inset-0 bg-black/40 hidden items-center justify-center p-4 z-50">
      <div
        class="w-full max-w-lg rounded-2xl bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 p-4">
        <div class="flex items-center justify-between mb-3">
          <h4 class="font-semibold">Link Method</h4>
          <button id="modal-close" class="p-1 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700"><i data-lucide="x"
              class="w-4 h-4"></i></button>
        </div>
        <form id="form-link" class="space-y-3">
          <select name="type"
            class="w-full rounded-xl border border-gray-200 dark:border-gray-700 bg-transparent px-3 py-2" required>
            <option value="bank">Bank Account</option>
            <option value="wallet">Crypto Wallet (USDT TRC20)</option>
          </select>
          <input name="label" placeholder="Label (e.g., Swiss Bank, TRC20 Wallet)"
            class="w-full rounded-xl border border-gray-200 dark:border-gray-700 bg-transparent px-3 py-2" required />
          <input name="details" placeholder="IBAN/Acct No or Wallet Address"
            class="w-full rounded-xl border border-gray-200 dark:border-gray-700 bg-transparent px-3 py-2" required />
          <div class="flex justify-end gap-2">
            <button type="button" id="modal-cancel"
              class="rounded-xl border border-gray-200 dark:border-gray-700 px-3 py-2">Cancel</button>
            <button class="rounded-xl bg-yellow-600 hover:bg-black text-white px-4 py-2">Save</button>
          </div>
        </form>
      </div>
    </div>

    <!-- APP SCRIPT -->
    <script type="module">
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js';
      import { getAuth, onAuthStateChanged, signOut, updatePassword, reauthenticateWithCredential, EmailAuthProvider, multiFactor, PhoneAuthProvider, PhoneMultiFactorGenerator } from 'https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js';
      import { getFirestore, doc, getDoc, setDoc, collection, query, where, orderBy, limit, getDocs, addDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js';

      // ====== CONFIG (replace with your real keys) ======
      const firebaseConfig = {
        apiKey: "AIzaSyAmAwp7hoJ0aXIuvJ4QmmbGqBtJFg1Xxrw",
        authDomain: "sinoinvest-d0593.firebaseapp.com",
        projectId: "sinoinvest-d0593",
        storageBucket: "sinoinvest-d0593.firebasestorage.app",
        messagingSenderId: "676999129836",
        appId: "1:676999129836:web:7c582892c0d94f7c9a13c9",
        measurementId: "G-L14SSD4V50"
      };

      // ====== INIT ======
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      // ====== UTIL ======
      const $ = (id) => document.getElementById(id);
      const $$ = (sel, root = document) => Array.from(root.querySelectorAll(sel));

      function showToast(msg, type = 'info') {
        const el = $('toast');
        el.className = `fixed top-5 right-5 z-50`;
        el.innerHTML = `<div class="rounded-xl px-4 py-3 shadow-soft border ${type === 'success' ? 'border-yellow-200 bg-emerald-50 text-gray-700' : type === 'error' ? 'border-rose-200 bg-rose-50 text-rose-700' : 'border-gray-200 bg-white text-gray-900'}">${msg}</div>`;
        el.classList.remove('hidden');
        setTimeout(() => { el.classList.add('hidden'); }, 3200);
      }

      function formatMoney(v, currency = 'USD') {
        const num = Number(v || 0);
        return new Intl.NumberFormat('en-US', { style: 'currency', currency }).format(num);
      }

      function setActive(route) {
        $$('#sideNav .nav-link').forEach(a => {
          const active = a.getAttribute('data-route') === route;
          a.classList.toggle('bg-gray-900', active);
          a.classList.toggle('text-white', active);
          a.classList.toggle('dark:bg-gray-700', active);
        });
        $$('#main .page');
      }

      // Router (hash-based)
      const routes = ['#/dashboard', '#/portfolio', '#/transactions', '#/funds', '#/messages', '#/settings', '#/support'];
      function navigate(hash) {
        const route = routes.includes(hash) ? hash : '#/dashboard';
        setActive(route);
        $('pageTitle').textContent = route.replace('#/', '').replace(/\b\w/g, ch => ch.toUpperCase());
        $$('.page').forEach(p => p.classList.remove('active'));
        const page = document.getElementById('page-' + route.replace('#/', ''));
        page?.classList.add('active');
        location.hash = route;
        if (route === '#/dashboard') drawCharts();
        if (route === '#/portfolio') drawPerf();
      }

      window.addEventListener('hashchange', () => navigate(location.hash));

      // Dark mode
      const btnDark = $('btn-dark');
      btnDark?.addEventListener('click', () => {
        document.documentElement.classList.toggle('dark');
        $('darkState').textContent = document.documentElement.classList.contains('dark') ? 'On' : 'Off';
        drawCharts(true); drawPerf(true);
      });

      // Sign out
      $('btn-signout')?.addEventListener('click', async () => {
        await signOut(auth);
        showToast('Signed out', 'success');
      });

      // ====== DEMO AUTH FALLBACK ======
      // For demo, if no user is logged in, mock a read-only view using a seeded UID.
      let currentUID = null;

      onAuthStateChanged(auth, async (user) => {
        if (user) {
          currentUID = user.uid;
          $('userEmail').textContent = user.email || '—';
          await bootstrapData();
        } else {
          // Anonymous demo user
          currentUID = 'demo-user-001';
          $('userEmail').textContent = 'demo@sinoinvest';
          await bootstrapData(true);
          showToast('Demo mode: sign in to persist data.', 'info');
        }
        navigate(location.hash);
      });

      // ====== DATA LAYERS ======
      async function bootstrapData(isDemo = false) {
        // Create baseline documents if missing
        const profileRef = doc(db, 'profiles', currentUID);
        const profileSnap = await getDoc(profileRef);
        if (!profileSnap.exists()) {
          await setDoc(profileRef, {
            fullName: isDemo ? 'Demo User' : '',
            phone: '',
            country: 'Nigeria',
            currency: 'USD',
            theme: 'system',
            createdAt: serverTimestamp()
          });
        }

        // Seed demo assets/tx if demo
        if (isDemo) {
          await seedDemo();
        }

        await loadKPI();
        await loadRecentTx();
        await loadPortfolio();
        await loadTransactions();
        await loadMessages();
        await loadAlerts();
        await loadPreferences();
        await loadLinkedMethods();
        await loadFAQs();
      }

      async function seedDemo() {
        // Check if there are existing transactions
        const txCol = collection(db, 'users', currentUID, 'transactions');
        const txSnap = await getDocs(query(txCol, limit(1)));
        if (!txSnap.empty) return;

        const assets = [
          { symbol: 'AAPL', name: 'Apple Inc.', class: 'stocks', units: 12, avgCost: 165, price: 195 },
          { symbol: 'TSLA', name: 'Tesla Inc.', class: 'stocks', units: 5, avgCost: 210, price: 230 },
          { symbol: 'BTC', name: 'Bitcoin', class: 'crypto', units: 0.12, avgCost: 52000, price: 61000 },
          { symbol: 'ETH', name: 'Ethereum', class: 'crypto', units: 1.8, avgCost: 1700, price: 3200 },
          { symbol: 'REIT1', name: 'Berlin Office REIT', class: 'real_estate', units: 100, avgCost: 10, price: 10.6 },
        ];
        for (const a of assets) {
          await addDoc(collection(db, 'users', currentUID, 'assets'), a);
        }
        const deposits = [5000, 3000, 2000];
        for (const amt of deposits) {
          await addDoc(txCol, { type: 'deposit', amount: amt, method: 'bank', status: 'completed', createdAt: serverTimestamp() });
        }
        await addDoc(txCol, { type: 'dividend', amount: 42.25, method: 'portfolio', status: 'completed', createdAt: serverTimestamp() });
      }

      // Load KPI
      async function loadKPI() {
        const assetsCol = collection(db, 'users', currentUID, 'assets');
        const assetsSnap = await getDocs(assetsCol);
        let invested = 0, value = 0;
        assetsSnap.forEach(docu => {
          const a = docu.data();
          invested += (a.units || 0) * (a.avgCost || 0);
          value += (a.units || 0) * (a.price || 0);
        });
        const returns = value - invested;
        $('kpi-invested').textContent = formatMoney(invested);
        $('kpi-returns').textContent = formatMoney(returns);
        $('kpi-balance').textContent = formatMoney(Math.max(0, 200 + (returns > 0 ? 50 : 0))); // demo balance
        $('kpi-roi7d').textContent = `${((returns / (invested || 1)) * 100).toFixed(2)}%`;
      }

      // Recent transactions
      async function loadRecentTx() {
        const txSnap = await getDocs(query(collection(db, 'users', currentUID, 'transactions'), orderBy('createdAt', 'desc'), limit(5)));
        const body = $('recentTxBody');
        body.innerHTML = '';
        txSnap.forEach(d => {
          const t = d.data();
          body.innerHTML += `<tr>
          <td class="py-2">${t.createdAt?.toDate?.().toLocaleDateString?.() || '—'}</td>
          <td class="py-2 capitalize">${t.type}</td>
          <td class="py-2">${t.asset || '-'}</td>
          <td class="py-2">${formatMoney(t.amount)}</td>
          <td class="py-2"><span class="text-xs px-2 py-0.5 rounded ${t.status === 'completed' ? 'bg-emerald-50 text-emerald-700' : 'bg-amber-50 text-amber-700'}">${t.status || 'pending'}</span></td>
        </tr>`;
        });
      }

      // Portfolio breakdown + holdings
      async function loadPortfolio() {
        const assetCol = collection(db, 'users', currentUID, 'assets');
        const snap = await getDocs(assetCol);
        const items = [];
        const byClass = { stocks: 0, crypto: 0, real_estate: 0 };
        snap.forEach(d => {
          const a = d.data();
          const market = (a.units || 0) * (a.price || 0);
          items.push({ id: d.id, ...a, market });
          byClass[a.class] = (byClass[a.class] || 0) + market;
        });
        // class breakdown UI
        const total = Object.values(byClass).reduce((s, v) => s + v, 0) || 1;
        const box = $('classBreakdown');
        box.innerHTML = '';
        Object.entries(byClass).forEach(([k, v]) => {
          const pct = (v / total * 100).toFixed(1);
          const label = k === 'real_estate' ? 'Real Estate' : k[0].toUpperCase() + k.slice(1);
          box.innerHTML += `<div class="flex items-center justify-between p-3 rounded-xl border border-gray-200 dark:border-gray-700">
          <span>${label}</span>
          <span class="font-semibold">${pct}%</span>
        </div>`;
        });

        // holdings table
        const body = $('assetsBody');
        body.innerHTML = '';
        for (const a of items) {
          const pl = a.market - (a.units * a.avgCost);
          const plCls = pl >= 0 ? 'text-emerald-600' : 'text-rose-600';
          body.innerHTML += `<tr>
          <td class="py-2">${a.name} <span class="text-xs text-gray-500">(${a.symbol})</span></td>
          <td class="py-2 capitalize">${a.class.replace('_', ' ')}</td>
          <td class="py-2">${a.units}</td>
          <td class="py-2">${formatMoney(a.avgCost)}</td>
          <td class="py-2">${formatMoney(a.market)}</td>
          <td class="py-2 ${plCls}">${pl >= 0 ? '+' : ''}${formatMoney(pl)}</td>
        </tr>`;
        }

        // search & filter
        $('assetSearch').addEventListener('input', (e) => filterAssets());
        $('assetFilter').addEventListener('change', () => filterAssets());
        function filterAssets() {
          const q = $('assetSearch').value.toLowerCase();
          const f = $('assetFilter').value;
          const rows = $$('#assetsBody tr');
          rows.forEach(r => {
            const name = r.children[0].textContent.toLowerCase();
            const cls = r.children[1].textContent.toLowerCase().replace(' ', '_');
            const match = name.includes(q) && (f === 'all' || f === cls);
            r.classList.toggle('hidden', !match);
          })
        }
      }

      // Transactions table
      async function loadTransactions() {
        const qcol = query(collection(db, 'users', currentUID, 'transactions'), orderBy('createdAt', 'desc'));
        const snap = await getDocs(qcol);
        const body = $('txBody');
        const rows = [];
        snap.forEach(d => {
          const t = d.data();
          rows.push(`<tr>
          <td class="py-2">${t.createdAt?.toDate?.().toLocaleString?.() || '—'}</td>
          <td class="py-2 capitalize">${t.type}</td>
          <td class="py-2">${t.ref || '-'}</td>
          <td class="py-2">${formatMoney(t.amount)}</td>
          <td class="py-2">${t.method || '-'}</td>
          <td class="py-2">${t.status || 'pending'}</td>
        </tr>`);
        });
        body.innerHTML = rows.join('');

        // filters
        $('txTypeFilter').addEventListener('change', applyFilters);
        $('txFrom').addEventListener('change', applyFilters);
        $('txTo').addEventListener('change', applyFilters);
        function applyFilters() {
          const type = $('txTypeFilter').value;
          const from = new Date($('txFrom').value || '1970-01-01');
          const to = new Date($('txTo').value || '2999-12-31');
          $$('#txBody tr').forEach(r => {
            const tType = r.children[1].textContent.toLowerCase();
            const tDate = new Date(r.children[0].textContent);
            const matchType = type === 'all' || tType === type;
            const matchDate = tDate >= from && tDate <= to;
            r.classList.toggle('hidden', !(matchType && matchDate));
          })
        }
      }

      // Linked methods
      async function loadLinkedMethods() {
        const snap = await getDocs(collection(db, 'users', currentUID, 'methods'));
        const box = $('linkedMethods');
        box.innerHTML = snap.empty ? '<span class="text-xs text-gray-500">None linked</span>' : '';
        snap.forEach(d => {
          const m = d.data();
          box.innerHTML += `<div class="text-sm">• ${m.type.toUpperCase()} — ${m.label}</div>`
        })
      }

      // Deposit/Withdraw
      $('form-deposit').addEventListener('submit', async (e) => {
        e.preventDefault();
        const data = Object.fromEntries(new FormData(e.target).entries());
        const amt = Number(data.amount);
        if (!amt || amt < 10) return showToast('Min deposit is $10', 'error');
        await addDoc(collection(db, 'users', currentUID, 'transactions'), { type: 'deposit', amount: amt, method: data.method, status: 'completed', createdAt: serverTimestamp() });
        showToast('Deposit recorded', 'success');
        e.target.reset();
        loadRecentTx(); loadTransactions();
      });

      $('form-withdraw').addEventListener('submit', async (e) => {
        e.preventDefault();
        const data = Object.fromEntries(new FormData(e.target).entries());
        const amt = Number(data.amount);
        if (!amt || amt < 10) return showToast('Min withdrawal is $10', 'error');
        await addDoc(collection(db, 'users', currentUID, 'transactions'), { type: 'withdrawal', amount: amt, method: data.method, status: 'pending', createdAt: serverTimestamp() });
        showToast('Withdrawal submitted (pending)', 'success');
        e.target.reset();
        loadTransactions();
      });

      // Link modal
      const modal = $('modal');
      $('btn-link').addEventListener('click', () => modal.classList.remove('hidden'));
      $('modal-close').addEventListener('click', () => modal.classList.add('hidden'));
      $('modal-cancel').addEventListener('click', () => modal.classList.add('hidden'));
      $('form-link').addEventListener('submit', async (e) => {
        e.preventDefault();
        const data = Object.fromEntries(new FormData(e.target).entries());
        await addDoc(collection(db, 'users', currentUID, 'methods'), data);
        showToast('Method linked', 'success');
        modal.classList.add('hidden');
        loadLinkedMethods();
      });

      // Messages + Alerts
      async function loadMessages() {
        const threadsCol = collection(db, 'users', currentUID, 'threads');
        const snap = await getDocs(threadsCol);
        const list = $('threads');
        list.innerHTML = '';
        if (snap.empty) {
          list.innerHTML = '<div class="text-sm text-gray-500">No conversations yet</div>';
        }
        snap.forEach(d => {
          const t = d.data();
          const el = document.createElement('button');
          el.className = 'w-full text-left p-3 rounded-xl border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700';
          el.textContent = t.subject || 'Support';
          el.onclick = () => openThread(d.id);
          list.appendChild(el);
        })
      }

      async function openThread(threadId) {
        const msgs = await getDocs(query(collection(db, 'users', currentUID, 'threads', threadId, 'messages'), orderBy('createdAt', 'asc')));
        const chat = $('chatWindow');
        chat.innerHTML = '';
        msgs.forEach(d => {
          const m = d.data();
          const me = m.sender === 'client';
          const bubble = document.createElement('div');
          bubble.className = `max-w-[80%] ${me ? 'ml-auto bg-emerald-600 text-white' : 'mr-auto bg-gray-100 dark:bg-gray-700'} px-3 py-2 rounded-2xl`;
          bubble.textContent = m.text;
          chat.appendChild(bubble);
        })
        chat.scrollTop = chat.scrollHeight;
        $('form-message').onsubmit = async (e) => {
          e.preventDefault();
          const text = $('msgText').value.trim();
          if (!text) return;
          await addDoc(collection(db, 'users', currentUID, 'threads', threadId, 'messages'), { text, sender: 'client', createdAt: serverTimestamp() });
          $('msgText').value = '';
          openThread(threadId);
        }
      }

      $('btn-new-thread').addEventListener('click', async () => {
        const ref = await addDoc(collection(db, 'users', currentUID, 'threads'), { subject: `Support ${new Date().toLocaleString()}`, createdAt: serverTimestamp() });
        await addDoc(collection(db, 'users', currentUID, 'threads', ref.id, 'messages'), { text: 'Hello, I need assistance.', sender: 'client', createdAt: serverTimestamp() });
        loadMessages();
      });

      async function loadAlerts() {
        const snap = await getDocs(collection(db, 'users', currentUID, 'alerts'));
        const box = $('alerts');
        box.innerHTML = '';
        snap.forEach(d => {
          const a = d.data();
          box.innerHTML += `<div class="p-3 rounded-xl border border-gray-200 dark:border-gray-700 flex items-center justify-between">
          <div>
            <div class="font-medium">${a.title || 'Alert'}</div>
            <div class="text-xs text-gray-500">${a.body || ''}</div>
          </div>
          <span class="text-xs text-gray-400">${a.createdAt?.toDate?.().toLocaleDateString?.() || ''}</span>
        </div>`
        })
        $('badge').classList.toggle('hidden', snap.empty);
        $('badge').textContent = snap.size;
        $('btn-clear-alerts').onclick = async () => {
          box.innerHTML = '';
          $('badge').classList.add('hidden');
          showToast('Alerts cleared', 'success');
        }
      }

      // Preferences/Settings
      async function loadPreferences() {
        const snap = await getDoc(doc(db, 'profiles', currentUID));
        const p = snap.data() || {};
        $('pref-language').value = p.language || 'en';
        $('pref-theme').value = p.theme || 'system';
        $('pref-currency').value = p.currency || 'USD';
        document.documentElement.classList.toggle('dark', (p.theme || 'system') === 'dark');
      }

      $('pref-language').addEventListener('change', async (e) => {
        await setDoc(doc(db, 'profiles', currentUID), { language: e.target.value }, { merge: true });
        showToast('Language updated', 'success');
      })
      $('pref-theme').addEventListener('change', async (e) => {
        await setDoc(doc(db, 'profiles', currentUID), { theme: e.target.value }, { merge: true });
        document.documentElement.classList.toggle('dark', e.target.value === 'dark');
        showToast('Theme updated', 'success');
        drawCharts(true); drawPerf(true);
      })
      $('pref-currency').addEventListener('change', async (e) => {
        await setDoc(doc(db, 'profiles', currentUID), { currency: e.target.value }, { merge: true });
        loadKPI();
        showToast('Currency set to ' + e.target.value, 'success');
      })

      $('form-profile').addEventListener('submit', async (e) => {
        e.preventDefault();
        const data = Object.fromEntries(new FormData(e.target).entries());
        await setDoc(doc(db, 'profiles', currentUID), data, { merge: true });
        showToast('Profile saved', 'success');
      })

      $('form-password').addEventListener('submit', async (e) => {
        e.preventDefault();
        showToast('Password update requires re-authentication in this demo.', 'info');
      })

      $('btn-enable-2fa').addEventListener('click', async () => {
        showToast('2FA setup flow should be handled via Firebase MFA (Phone).', 'info');
      });

      // FAQs
      async function loadFAQs() {
        const items = [
          { q: 'How long do withdrawals take?', a: 'Typically T+1 business day after compliance checks.' },
          { q: 'Where are my funds held?', a: 'With regulated custodians and broker partners. Details available in your account docs.' },
          { q: 'How are returns calculated?', a: 'Time-weighted returns combining mark-to-market and cashflows.' },
        ];
        const box = $('faqs');
        box.innerHTML = items.map((it, i) => `
        <details class="py-3 group">
          <summary class="cursor-pointer font-medium flex items-center justify-between">
            <span>${it.q}</span>
            <span class="text-gray-400 group-open:rotate-180 transition-transform"><i data-lucide="chevron-down" class="w-4 h-4"></i></span>
          </summary>
          <p class="mt-2 text-sm text-gray-600 dark:text-gray-300">${it.a}</p>
        </details>`).join('');
        lucide.createIcons();
      }

      // ====== CHARTS ======
      let allocationChart, roiChart, perfChart;

      async function getAllocationData() {
        const snap = await getDocs(collection(db, 'users', currentUID, 'assets'));
        const byClass = { stocks: 0, crypto: 0, real_estate: 0 };
        snap.forEach(d => {
          const a = d.data();
          byClass[a.class] += (a.units || 0) * (a.price || 0);
        });
        return {
          labels: ['Stocks', 'Crypto', 'Real Estate'],
          values: [byClass.stocks, byClass.crypto, byClass.real_estate]
        };
      }

      async function getROIData() {
        const snap = await getDocs(collection(db, 'users', currentUID, 'assets'));
        const byClass = { stocks: { inv: 0, val: 0 }, crypto: { inv: 0, val: 0 }, real_estate: { inv: 0, val: 0 } };
        snap.forEach(d => {
          const a = d.data();
          byClass[a.class].inv += (a.units || 0) * (a.avgCost || 0);
          byClass[a.class].val += (a.units || 0) * (a.price || 0);
        });
        const classes = ['stocks', 'crypto', 'real_estate'];
        const rois = classes.map(k => (byClass[k].val - byClass[k].inv) / (byClass[k].inv || 1) * 100);
        return { labels: ['Stocks', 'Crypto', 'Real Estate'], values: rois };
      }

      async function drawCharts(refresh = false) {
        const alloc = await getAllocationData();
        const ctxA = document.getElementById('chartAllocation');
        const ctxR = document.getElementById('chartROI');
        if (allocationChart && refresh) { allocationChart.destroy(); roiChart.destroy(); }
        allocationChart = new Chart(ctxA, { type: 'pie', data: { labels: alloc.labels, datasets: [{ data: alloc.values }] }, options: { plugins: { legend: { position: 'bottom' } } } });
        const roi = await getROIData();
        roiChart = new Chart(ctxR, { type: 'bar', data: { labels: roi.labels, datasets: [{ label: 'ROI %', data: roi.values }] }, options: { scales: { y: { ticks: { callback: (v) => v + '%' } } } } });
      }

      async function drawPerf(refresh = false) {
        const ctx = document.getElementById('chartPerf');
        if (perfChart && refresh) perfChart.destroy();
        const days = Number(document.getElementById('perfRange').value || 30);
        // Demo line series
        const labels = Array.from({ length: days }, (_, i) => new Date(Date.now() - (days - i) * 86400000)).map(d => d.toLocaleDateString());
        let val = 8000; const series = [];
        for (let i = 0; i < days; i++) { val += (Math.random() - 0.45) * 80; series.push(Math.max(5000, Math.round(val))); }
        perfChart = new Chart(ctx, { type: 'line', data: { labels, datasets: [{ label: 'Portfolio Value', data: series, tension: 0.35, fill: false }] }, options: { plugins: { legend: { display: false } } } });
      }
      $('perfRange').addEventListener('change', () => drawPerf(true));

      // ====== NAV INIT ======
      $$('#sideNav a').forEach(a => a.addEventListener('click', () => navigate(a.getAttribute('data-route'))));

      // ====== ICONS ======
      lucide.createIcons();

    </script>
  </body>

</html>
