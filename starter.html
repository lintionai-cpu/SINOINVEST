<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Investor StartUp</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Firebase SDK -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
      import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";
      import { getFirestore, setDoc, doc } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyAmAwp7hoJ0aXIuvJ4QmmbGqBtJFg1Xxrw",
        authDomain: "sinoinvest-d0593.firebaseapp.com",
        projectId: "sinoinvest-d0593",
        storageBucket: "sinoinvest-d0593.firebasestorage.app",
        messagingSenderId: "676999129836",
        appId: "1:676999129836:web:7c582892c0d94f7c9a13c9",
        measurementId: "G-L14SSD4V50"
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      let currentStep = 1;
      let selectedPlan = "";

      function showToast(message, bgClass = "bg-gray-800") {
        // Create toast container if it doesn’t exist
        let container = document.getElementById("toast-container");
        if (!container) {
          container = document.createElement("div");
          container.id = "toast-container";
          container.className = "fixed top-4 right-4 z-50 space-y-2";
          document.body.appendChild(container);
        }

        // Create toast element
        const toast = document.createElement("div");
        toast.className = `text-white px-4 py-2 rounded-lg shadow-lg transition-opacity duration-500 opacity-0 ${bgClass}`;
        toast.textContent = message;

        // Append toast
        container.appendChild(toast);

        // Fade in
        setTimeout(() => toast.classList.remove("opacity-0"), 100);

        // Fade out + remove after 3s
        setTimeout(() => {
          toast.classList.add("opacity-0");
          setTimeout(() => toast.remove(), 500);
        }, 3000);
      }


      window.openPlanModal = () => {
        document.getElementById("planModal").classList.remove("hidden");
      };

      window.closePlanModal = () => {
        document.getElementById("planModal").classList.add("hidden");
      };

      window.choosePlan = (planName) => {
        selectedPlan = planName;
        document.getElementById("selectedPlanDisplay").innerText = planName;
        closePlanModal();
      };

      window.nextStep = function () {
        if (!validateStep(currentStep)) return;
        document.getElementById(`step-${currentStep}`).classList.add("hidden");
        currentStep++;
        document.getElementById(`step-${currentStep}`).classList.remove("hidden");
        updateProgress();
      };

      window.prevStep = function () {
        document.getElementById(`step-${currentStep}`).classList.add("hidden");
        currentStep--;
        document.getElementById(`step-${currentStep}`).classList.remove("hidden");
        updateProgress();
      };

      function updateProgress() {
        const steps = document.querySelectorAll(".progress-step");
        steps.forEach((step, index) => {
          step.classList.toggle("bg-amber-600", index < currentStep);
          step.classList.toggle("bg-gray-300", index >= currentStep);
        });
      }

      function validateStep(step) {
        let valid = true;
        const inputs = document.querySelectorAll(`#step-${step} input, #step-${step} select`);
        inputs.forEach(input => {
          if (!input.checkValidity()) {
            input.classList.add("border-red-500");
            valid = false;
          } else {
            input.classList.remove("border-red-500");
          }
        });
        if (step === 1 && !selectedPlan) {
          Swal.fire({ icon: 'error', title: 'Please select an investment plan!' });
          return false;
        }
        if (!valid) {
          Swal.fire({ icon: 'error', title: 'Please fill all required fields correctly!' });
        }
        return valid;
      }

      window.registerUser = async function (e) {
        e.preventDefault();
        if (!validateStep(currentStep)) return;

        const personal = {
          plan: selectedPlan,
          name: document.getElementById("fullName").value,
          dob: document.getElementById("dob").value,
          gender: document.getElementById("gender").value
        };

        const contact = {
          email: document.getElementById("email").value,
          password: document.getElementById("password").value,
          phone: document.getElementById("phone").value,
          address: document.getElementById("address").value
        };

        // Step 3 fields
        const paymentMethod = document.querySelector('input[name="paymentMethod"]:checked')?.value;
        let paymentDetails = {};

        if (paymentMethod === "bank") {
          paymentDetails = {
            bankName: "Chase Bank",
            bankAccount: "1234567890",
            bankSwift: "CHASUS33",
            senderAccountName: document.getElementById("senderAccountName").value.trim(),
            senderAccountNumber: document.getElementById("senderAccountNumber").value.trim(),
            transactionRef: document.getElementById("transactionRef").value.trim(),
          };
        } else if (paymentMethod === "crypto") {
          paymentDetails = {
            BTC: "bc1qekl97n3eg54lhwx6s8e25ttyk7g64ctvw80",
            ETH: "0x742d35Cc6634C0532925a3b844Bc454e4438f44e",
            USDT_TRC20: "TA7GGJQWTNfG83XzaiDNBn3z8yTsB5xte",
            senderWallet: document.getElementById("senderWallet").value.trim(),
            network: document.getElementById("network").value.trim(),
            transactionHash: document.getElementById("transactionHash").value.trim(),
          };
        }

        // Validation
        if (!personal.name || !personal.dob || !contact.email || !contact.password || !contact.phone || !contact.address || !paymentMethod) {
          showToast("Please fill all required fields", "bg-red-500");
          return;
        }

        try {
          const userCredential = await createUserWithEmailAndPassword(
            auth,
            contact.email,
            contact.password
          );
          const user = userCredential.user;

          await setDoc(doc(db, "client", user.uid), {
            role: "client",
            plan: personal.plan,
            fullName: personal.name,   // ✅ now the string, not <input>
            dob: personal.dob,
            gender: personal.gender,
            email: contact.email,
            phone: contact.phone,
            address: contact.address,
            paymentMethod,
            paymentDetails,
            paymentStatus: "unpaid",
            createdAt: new Date().toISOString()
          });

          Swal.fire({
            icon: 'success',
            title: 'Registration Successful!',
            text: 'Redirecting to login...',
            timer: 2000,
            showConfirmButton: false
          });

          showToast("Registration successful!", "bg-green-500");

          setTimeout(() => {
            window.location.href = "../public/login.html";
          }, 2000);

        } catch (error) {
          Swal.fire({ icon: 'error', title: error.message });
        }
      };


    </script>
  </head>

  <body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <!-- Toast -->
    <div id="toast" class="opacity-0"></div>
    <!-- Modal -->
    <div id="planModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-60 hidden z-50">
      <div class="bg-white rounded-lg shadow-lg p-6 w-[80%] h-[80%] overflow-y-auto">
        <h2 class="text-2xl font-bold mb-4">Choose Your Portfolio Plan</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <!-- STOCKS -->
          <div class="bg-gray-100 rounded-xl p-4">
            <h3 class="text-lg font-semibold text-gray-700 text-center mb-3">Stocks Portfolio</h3>
            <div class="space-y-4">
              <div class="p-4 border rounded-lg">
                <h4 class="font-bold">Basic</h4>
                <ul class="text-sm text-gray-600 mt-2 space-y-1">
                  <li>💼 €500 min investment</li>
                  <li>💼 €1,000 max investment</li>
                  <li>📈 Monthly report</li>
                </ul>
                <button onclick="choosePlan('Stocks-Basic Plan')"
                  class="mt-3 w-full bg-gray-600 text-white py-2 rounded">Select</button>
              </div>
              <div class="p-4 border rounded-lg">
                <h4 class="font-bold">Standard</h4>
                <ul class="text-sm text-gray-600 mt-2 space-y-1">
                  <li>💼 €1,000 min investment</li>
                  <li>💼 €5,000 max investment</li>
                  <li>📊 Quarterly insights</li>
                </ul>
                <button onclick="choosePlan('Stocks-Standard Plan')"
                  class="mt-3 w-full bg-gray-600 text-white py-2 rounded">Select</button>
              </div>
              <div class="p-4 border rounded-lg">
                <h4 class="font-bold">Premium</h4>
                <ul class="text-sm text-gray-600 mt-2 space-y-1">
                  <li>💼 Min €5,000</li>
                  <li>💼 Max €15,000</li>
                  <li>🧠 AI strategy + advisor</li>
                </ul>
                <button onclick="choosePlan('Stocks-Premium Plan')"
                  class="mt-3 w-full bg-gray-600 text-white py-2 rounded">Select</button>
              </div>
            </div>
          </div>

          <!-- CRYPTO -->
          <div class="bg-gray-100 rounded-xl p-4">
            <h3 class="text-lg font-semibold text-yellow-700 text-center mb-3">Crypto Portfolio</h3>
            <div class="space-y-4">
              <div class="p-4 border rounded-lg">
                <h4 class="font-bold">Basic</h4>
                <ul class="text-sm text-gray-600 mt-2 space-y-1">
                  <li>🔐 Min. €500 crypto</li>
                  <li>🔐 Max. €5,000 crypto</li>
                  <li>📈 Weekly updates</li>
                </ul>
                <button onclick="choosePlan('Crypto-Basic Plan')"
                  class="mt-3 w-full bg-yellow-600 text-white py-2 rounded">Select</button>
              </div>
              <div class="p-4 border rounded-lg">
                <h4 class="font-bold">Standard</h4>
                <ul class="text-sm text-gray-600 mt-2 space-y-1">
                  <li>🔐 Min. €5,000 crypto</li>
                  <li>🔐 Max. €15,000 crypto</li>
                  <li>🛡️ Staking rewards</li>
                </ul>
                <button onclick="choosePlan('Crypto-Standard Plan')"
                  class="mt-3 w-full bg-yellow-600 text-white py-2 rounded">Select</button>
              </div>
              <div class="p-4 border rounded-lg">
                <h4 class="font-bold">Premium</h4>
                <ul class="text-sm text-gray-600 mt-2 space-y-1">
                  <li>🔐 Min. $15,000 crypto</li>
                  <li>🔐 Max. $50,000 crypto</li>
                  <li>📊 On-chain analytics</li>
                </ul>
                <button onclick="choosePlan('Crypto-Premium Plan')"
                  class="mt-3 w-full bg-yellow-600 text-white py-2 rounded">Select</button>
              </div>
            </div>
          </div>

          <!-- REAL ESTATE -->
          <div class="bg-gray-100 rounded-xl p-4">
            <h3 class="text-lg font-semibold text-gray-700 text-center mb-3">Real Estate Portfolio</h3>
            <div class="space-y-4">
              <div class="p-4 border rounded-lg">
                <h4 class="font-bold">Basic</h4>
                <ul class="text-sm text-gray-600 mt-2 space-y-1">
                  <li>🏘️ Min. €1,000 co-invest</li>
                  <li>🏘️ Max. €5,000 co-invest</li>
                  <li>📊 Monthly returns</li>
                </ul>
                <button onclick="choosePlan('Real-Estate-Basic Plan')"
                  class="mt-3 w-full bg-gray-600 text-white py-2 rounded">Select</button>
              </div>
              <div class="p-4 border rounded-lg">
                <h4 class="font-bold">Standard</h4>
                <ul class="text-sm text-gray-600 mt-2 space-y-1">
                  <li>🏘️ Min. €5,000 co-invest</li>
                  <li>🏘️ Max. €15,000 co-invest</li>
                  <li>📍 Visit scheduling</li>
                </ul>
                <button onclick="choosePlan('Real-Estate-Standard Plan')"
                  class="mt-3 w-full bg-gray-600 text-white py-2 rounded">Select</button>
              </div>
              <div class="p-4 border rounded-lg">
                <h4 class="font-bold">Premium</h4>
                <ul class="text-sm text-gray-600 mt-2 space-y-1">
                  <li>🏘️ Min. $15,000 co-invest</li>
                  <li>🏢 Commercial assets</li>
                  <li>👤 Dedicated strategist</li>
                </ul>
                <button onclick="choosePlan('Real-Estate-Premium Plan')"
                  class="mt-3 w-full bg-gray-600 text-white py-2 rounded">Select</button>
              </div>
            </div>
          </div>
        </div>
        <button onclick="closePlanModal()" class="mt-4 bg-red-500 text-white px-4 py-2 rounded">Close</button>
      </div>
    </div>

    <!-- Registration Form -->
    <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-xl">
      <!-- Progress bar -->
      <div class="flex justify-between mb-6">
        <div class="progress-step w-8 h-8 rounded-full flex items-center justify-center bg-amber-600 text-white">1</div>
        <div class="progress-step w-8 h-8 rounded-full flex items-center justify-center bg-gray-300 text-white">2</div>
        <div class="progress-step w-8 h-8 rounded-full flex items-center justify-center bg-gray-300 text-white">3</div>
      </div>

      <form id="registerForm" onsubmit="registerUser(event)">
        <!-- Step 1 -->
        <div id="step-1">
          <h2 class="text-xl font-bold mb-4">Select Plan & Personal Information</h2>
          <div class="mb-4">
            <button type="button" onclick="openPlanModal()" class="bg-amber-600 text-white px-4 py-2 rounded-lg">Choose
              Plan</button>
            <p class="mt-2">Selected Plan: <span id="selectedPlanDisplay" class="font-bold text-amber-600">None</span>
            </p>
          </div>
          <input type="text" id="fullName" placeholder="Full Name" required class="w-full p-3 border rounded-lg mb-3">
          <input type="date" id="dob" required class="w-full p-3 border rounded-lg mb-3">
          <select id="gender" required class="w-full p-3 border rounded-lg mb-3">
            <option value="">Select Gender</option>
            <option>Male</option>
            <option>Female</option>
            <option>Other</option>
          </select>
          <button type="button" onclick="nextStep()" class="bg-amber-600 text-white py-2 px-4 rounded-lg">Next</button>
        </div>

        <!-- Step 2 -->
        <div id="step-2" class="hidden">
          <h2 class="text-xl font-bold mb-4">Contact Information</h2>
          <input type="email" id="email" placeholder="Email" required class="w-full p-3 border rounded-lg mb-3">
          <input type="password" id="password" placeholder="Password" minlength="6" required
            class="w-full p-3 border rounded-lg mb-3">
          <input type="tel" id="phone" placeholder="Phone" pattern="\d{10,}" required
            class="w-full p-3 border rounded-lg mb-3">
          <input type="text" id="address" placeholder="Address" required class="w-full p-3 border rounded-lg mb-3">
          <div class="flex justify-between">
            <button type="button" onclick="prevStep()" class="bg-gray-400 text-white py-2 px-4 rounded-lg">Back</button>
            <button type="button" onclick="nextStep()"
              class="bg-amber-600 text-white py-2 px-4 rounded-lg">Next</button>
          </div>
        </div>

        <!-- Step 3 -->
        <div class="hidden" id="step-3">
          <h2 class="text-xl font-bold mb-4">Payment Method</h2>
          <label class="block mb-2"><input type="radio" name="paymentMethod" value="bank" onchange="togglePayment()">
            Bank Transfer</label>
          <label class="block mb-4"><input type="radio" name="paymentMethod" value="crypto" onchange="togglePayment()">
            Crypto Transfer</label>

          <!-- Bank Transfer -->
          <div id="bankSection" class="hidden border p-4 rounded-lg bg-gray-50">
            <p class="font-semibold">Receiving Account:</p>
            <p>Bank: Chase Bank</p>
            <p>Account No: 1234567890</p>
            <p>SWIFT: CHASUS33</p>
            <input type="text" id="senderAccountName" placeholder="Your Account Name" class="input mt-2" />
            <input type="text" id="senderAccountNumber" placeholder="Your Account Number" class="input" />
            <input type="text" id="transactionRef" placeholder="Transaction Reference" class="input" />
          </div>

          <!-- Crypto Transfer -->
          <div id="cryptoSection" class="hidden border p-4 rounded-lg bg-gray-50">
            <p class="font-semibold">Receiving Wallets:</p>
            <div class="flex items-center space-x-4 p-4 bg-gray-100 rounded">
              <img src="img/bitcoin.png " alt="BTC" class="w-8 h-8">
              <div>
                <h3 class="text-lg font-bold">Bitcoin (BTC)</h3>
                <p class="text-sm">Wallet address: <br> <strong>bc1qekl97n3eg54lhwx6s8e25ttyk7g64ctvw80</strong></p>
              </div>
            </div>
            <div class="flex items-center space-x-4 p-4 bg-gray-100 rounded">
              <img
                src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/05/Ethereum_logo_2014.svg/200px-Ethereum_logo_2014.svg.png"
                alt="ETH" class="w-8 h-8">
              <div>
                <h3 class="text-lg font-bold">Ethereum (ETH)</h3>
                <p class="text-sm">Wallet address: <strong>0x008661b1B1388216bb1306056cCE766197A3659</strong></p>
              </div>
            </div>
            <div class="flex items-center space-x-4 p-4 bg-gray-100 rounded">
              <img
                src="https://s3.amazonaws.com/cdn.freshdesk.com/data/helpdesk/attachments/production/43345102421/original/5r8_zDRco8RuYLn6H-Blx1DsT46QMBPv9w.png?1659016377="
                alt="USDT-TRC20" class="w-8 h-8">

              <div>
                <h3 class="text-lg font-bold">USDT(TRC20)</h3>
                <p class="text-sm">Wallet address:
                  <br>
                  <strong>TA7GGJQWTNfG83XzaiDNBn3z8yTsB5xte</strong>
                </p>
              </div>
            </div>

            <input type="text" id="senderWallet" placeholder="Your Wallet Address" class="input mt-2" required />
            <input type="text" id="network" placeholder="Network (BTC/ETH/TRC20)" class="input" required />
            <input type="text" id="transactionHash" placeholder="Transaction Hash" class="input" required />
          </div>
          <button type="button" onclick="prevStep()" class="bg-gray-400 text-white py-2 px-4 rounded-lg">Back</button>
          <button onclick="registerUser(event)" t ype="submit"
            class="bg-yellow-600 text-white py-2 px-4 rounded-lg">Finish</button>
        </div>
    </div>
    </form>
    </div>


    <script>
      function nextStep(step) {
        document.querySelectorAll(".step").forEach(s => s.classList.add("hidden"));
        document.getElementById(`step${step}`).classList.remove("hidden");
      }
      function togglePayment() {
        const method = document.querySelector('input[name="paymentMethod"]:checked').value;
        document.getElementById("bankSection").classList.toggle("hidden", method !== "bank");
        document.getElementById("cryptoSection").classList.toggle("hidden", method !== "crypto");
      }
      // Tailwind style helper
      document.querySelectorAll('.input').forEach(el => {
        el.classList.add("w-full", "p-3", "border", "rounded-lg", "focus:outline-none", "focus:ring", "focus:ring-amber-300", "mb-3");
      });
      document.querySelectorAll('.btn').forEach(el => {
        el.classList.add("bg-amber-600", "text-white", "py-2", "px-4", "rounded-lg", "hover:bg-amber-700");
      });
    </script>
  </body>

</html>
